<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqldiff PUBLIC "-//OpenMRS//DTD OpenMRS SQL Diff Config 1.0//EN" "http://resources.openmrs.org/doctype/sqldiff-1.0.dtd">

<sqldiff version="1.0">
	<help>
		USE:
		The diffs are ordered by datamodel version number.
		The script
		can be run in a top down fashion and is
		expected to not failor
		overwrite old data

		EXPECT:
		- "use business-database-name;" was called
		prior to
		calling this script
	</help>
	<diff>
		<version>1.0.0</version>
		<author>Tammy Dugan</author>
		<date>Jan 27, 2010</date>
		<description>
			Initial database setup.
		</description>
		<sql>
			INSERT INTO atd_state(`name`) values ('create_survey');
			INSERT INTO atd_state(`name`) values ('wait_to_submit_survey');
			INSERT INTO atd_state(`name`) values ('process_survey');
		</sql>
	</diff>
	
	<diff>
		<version>1.0.1</version>
		<author>Jun Wang</author>
		<date>Mar 29, 2010</date>
		<description>
			Setting up the concept dictionary and others.
		</description>
		<sql>
			CREATE TABLE `survey_partner` (
 				 `id` int(11) NOT NULL auto_increment,
 				 `patient_id` int(11) NOT NULL,
 				 `partner_name` varchar(100) NOT NULL,
  				`partner_type` varchar(50) default NULL,
  				`times_selected` int(11) NOT NULL default '0',
  				`date_created` datetime NOT NULL,
  				`date_changed` datetime NOT NULL,
  				`voided` smallint(6) NOT NULL default '0',
  				`voided_by` int(11) default NULL,
  				`date_voided` datetime default NULL,
  				`void_reason` varchar(255) default NULL,
  				PRIMARY KEY  (`id`),
  				KEY `voided_by_user` (`voided_by`),
  				CONSTRAINT `voided_by_user` FOREIGN KEY (`voided_by`) REFERENCES `users` (`user_id`)
			) ENGINE=InnoDB DEFAULT CHARSET=utf8;
				
			CREATE TABLE `survey_session` (
  				`id` int(11) NOT NULL auto_increment,
  				`patient_id` int(11) NOT NULL,
  				`survey_type` varchar(100) NOT NULL default '',
  				`session_id` int(11) NOT NULL,
  				`encounter_id` int(11) NOT NULL,
  				`start_time` datetime NOT NULL,
  				`end_time` datetime default NULL,
  				`voided` smallint(6) NOT NULL default '0',
  				`voided_by` int(11) default NULL,
  				`date_voided` datetime default NULL,
  				`void_reason` varchar(255) default NULL,
  				PRIMARY KEY  (`id`),
  				KEY `user_who_takes_what_survey` (`patient_id`,`survey_type`),
  				KEY `user_who_voided_survey` (`voided_by`),
  				KEY `encounter_for_survey` (`encounter_id`),
  				CONSTRAINT `user_who_voided_survey` FOREIGN KEY (`voided_by`) REFERENCES `users` (`user_id`)
			) ENGINE=InnoDB DEFAULT CHARSET=utf8;
			
		</sql>
		
	</diff>
		<diff>
		<version>1.0.2</version>
		<author>Tammy Dugan</author>
		<date>Oct 6th 2010</date>
		<description>
			Add table for gps data.
		</description>
		<sql>
	CREATE TABLE `pearlgrlz_gps_data` (
  `gps_data_id` int(11) NOT NULL AUTO_INCREMENT,
  `longitude` double NOT NULL,
  `latitude` double NOT NULL,
  `phone_name` varchar(40) NOT NULL,
  `time` datetime NOT NULL,
  PRIMARY KEY (`gps_data_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
</sql>
	</diff>
	
</sqldiff>
